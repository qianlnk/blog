# 服务发现

如果服务少，可以通过硬编码或配置文件提供服务地址。但是面对大量服务实例和频繁的上线部署，服务之间如果想知道彼此的服务地址和运行状态，这时候就需要服务发现组件来实现。

## 服务发现概述

使用一个注册中心来记录分布式系统中全部服务信息，以便让其他服务能快速找到这些已经注册的服务。要尽量做到高可用。

服务发现模块需要有服务注册、服务查找、服务健康检查和服务变更通知等关键功能。

    可以通过服务名称来查找和使用服务，而不需要提供网络地址和端口号。
    DNS可以说是最早的服务发现实例。
    微服务更新、发布频繁，并且常根据负载情况进行弹性伸缩，因此微服务IP地址变化是常态。

## 服务发现基本机制：

- 服务提供者在服务启动时，将服务名称、IP地址、访问端口以及其他服务的元数据信息注册到注册中心。
- 注册中心与服务提供者无法维持心跳探测时会将服务从注册中心剔除。
- 服务消费者从注册中心获取服务提供者最新信息时，可以使用定时拉取和事件通知两种方式。

## 使用zk实现服务发现：

每个服务启动时，在zk中注册。这是zk是一个注册中心的角色。服务使用方通过Znode快速查找相应的服务。如果服务宕机，那么这个服务节点会与ZK在超过会话时间后失效，那么这个Znode会被删除，而监听它们的客户端监听器得到宕机消息，进而得到最新的服务列表。

**zk的优势与不足**

zk是使用最为广泛的分布式协调组件，最大的优点是使用广泛。

zk不是服务发现领域的最佳选择了，它的优势是选举和分布式锁等分布式强一致性的场景。

ZK在主节点故障的时候，要选举，这个时候集群不可用，导致注册服务在选举的时候瘫痪（这是因为强一致性导致的不可用）。　　　　   


**Erueka**

与ZK不同的是，zk是基于CP的，Erueka是基于AP的。

专门是Java语言的服务注册工具。

Eureka比ZK更加适合服务发现，优先保证可用性，去中心化，服务集群由对等节点组成。