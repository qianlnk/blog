# 进程控制块

为了描述和控制进程的运行，系统为每个进程定义了一个数据结构——进程控制块 PCB(Process Control Block)，它是进程实体的一部分，是操作系统中最重要的记录型数据结 构。PCB 中记录了操作系统所需的、用于描述进程的当前情况以及控制进程运行的全部信 息。

## 作用

使一个在多道程序环境下不能独立运行的程序(含数据)，成为一个 能独立运行的基本单位，一个能与其它进程并发执行的进程。或者说，OS 是根据 PCB 来对 并发执行的进程进行控制和管理的。

当系统创建一个新进程时，就为它建立了一个 PCB;进程结束时又回收其 PCB，进程 于是也随之消亡。PCB 可以被操作系统中的多个模块读或修改，如被调度程序、资源分配 程序、中断处理程序以及监督和分析程序等读或修改。因为 PCB 经常被系统访问，尤其是 被运行频率很高的进程及分派程序访问，故 PCB 应常驻内存。系统将所有的 PCB 组织成若 干个链表(或队列)，存放在操作系统中专门开辟的 PCB 区内。例如在 Linux 系统中用 task_struct 数据结构来描述每个进程的进程控制块，在 Windows 操作系统中则使用一个执行 体进程块(EPROCESS)来表示进程对象的基本属性。

## 进程控制块中的信息

在进程控制块中，主要包括下述四方面的信息。

1. 进程标识符

    进程标识符用于惟一地标识一个进程。一个进程通常有两种标识符:

    - 内部标识符。在所有的操作系统中，都为每一个进程赋予了一个惟一的数字标识符，它通常是一个进程的序号。设置内部标识符主要是为了方便系统使用。
    
    - 外部标识符。它由创建者提供，通常是由字母、数字组成，往往是由用户(进程)在访问该进程时使用。为了描述进程的家族关系，还应设置父进程标识及子进程标识。此外， 还可设置用户标识，以指示拥有该进程的用户。

2. 处理机状态

    处理机状态信息主要是由处理机的各种寄存器中的内容组成的。处理机在运行时，许 多信息都放在寄存器中。当处理机被中断时，所有这些信息都必须保存在 PCB 中，以便在 该进程重新执行时，能从断点继续执行。这些寄存器包括:1 通用寄存器，又称为用户可 视寄存器，它们是用户程序可以访问的，用于暂存信息，在大多数处理机中，有 8~32 个 通用寄存器，在 RISC 结构的计算机中可超过 100 个;2 指令计数器，其中存放了要访问 的下一条指令的地址;3 程序状态字 PSW，其中含有状态信息，如条件码、执行方式、中 断屏蔽标志等;4 用户栈指针，指每个用户进程都有一个或若干个与之相关的系统栈，用 于存放过程和系统调用参数及调用地址，栈指针指向该栈的栈顶。

3. 进程调度信息

    在 PCB 中还存放一些与进程调度和进程对换有关的信息，包括:1 进程状态，指明进 程的当前状态，作为进程调度和对换时的依据;2 进程优先级，用于描述进程使用处理机 的优先级别的一个整数，优先级高的进程应优先获得处理机;3 进程调度所需的其它信息， 它们与所采用的进程调度算法有关，比如，进程已等待 CPU 的时间总和、进程已执行的时 间总和等;4 事件，指进程由执行状态转变为阻塞状态所等待发生的事件，即阻塞原因。

4. 进程控制信息

    进程控制信息包括:
    
    1. 程序和数据的地址，指进程的程序和数据所在的内存或外存地 (首)址，以便再调度到该进程执行时，能从 PCB 中找到其程序和数据;
    2. 进程同步和通信 机制，指实现进程同步和进程通信时必需的机制，如消息队列指针、信号量等，它们可能 全部或部分地放在 PCB 中;
    3. 资源清单，即一张列出了除 CPU 以外的、进程所需的全部 资源及已经分配到该进程的资源的清单;
    4. 链接指针，它给出了本进程(PCB)所在队列中 的下一个进程的 PCB 的首地址。
    
## 进程控制块的组织方式
    
1) 链接方式

![](/uploads/upload_28747d2d5a94f4b70e21500286dac73b.png)


这是把具有同一状态的 PCB，用其中 的链接字链接成一个队列。这样，可以形 执行指针 成就绪队列、若干个阻塞队列和空白队列 等。对其中的就绪队列常按进程优先级的 高低排列，把优先级高的进程的 PCB 排在 队列前面。此外，也可根据阻塞原因的不 同而把处于阻塞状态的进程的 PCB 排成等待 I/O 操作完成的队列和等待分配内存 的队列等。图 2-9 示出了一种链接队列的组织方式

2) 索引方式

![](/uploads/upload_f318d54c3566f2b5910292f5565d8aac.png)


系统根据所有进程的状态建立几张索引表。例如，就绪索引表、阻塞索引表等，并把各索引表在内存的首地址记录在内存的一些专用单元中。在每个索引表的表目中，记录具有相应状态的某个 PCB 在 PCB 表中的地址。图 2-10 示出了索引方式的 PCB 组织。